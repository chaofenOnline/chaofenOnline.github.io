window.__require=function e(t,i,o){function r(s,c){if(!i[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){return r(t[s][1][e]||e)},h,h.exports,e,t,i,o)}return i[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<o.length;s++)r(o[s]);return r}({Alert:[function(e,t,i){"use strict";cc._RF.push(t,"c6a8fRZogRMEoiezwSh20jW","Alert"),cc.Class({extends:cc.Component,properties:{},start:function(){},enterCB:function(){cc.director.loadScene("Game")}}),cc._RF.pop()},{}],Board:[function(e,t,i){"use strict";cc._RF.push(t,"4a466EjV7tPA6b0e4+H77EJ","Board");var o=e("Config"),r=function(e){return e&&e.__esModule?e:{default:e}}(e("./util/Util"));var n=0;cc.Class({extends:cc.Component,properties:{hexSide:5,tileH:110,tilePic:{default:null,type:cc.SpriteFrame},dropScore:20},onLoad:function(){this.status=1,this.setHexagonGrid(),this.getOldScore()},getOldScore:function(){var e=cc.sys.localStorage.getItem("score");cc.find("Canvas/OldScore").getComponent(cc.Label).string=Number(e)},dropSuccess:function(e){this.deleteAnimInitNode=null,this.deleteAnimCount=0,this.deleteNodeArr=[];var t=[],i=[],n=this.boardFrameList;this.isDeleting=!0,this.addDropScore(e);for(var s=0;s<n.length;s++){n[s].isFulled&&t.push(s)}for(var c=0;c<o.DelRules.length;c++){var a=o.DelRules[c],l=r.default.arrIntersect(t,a);if(l.length>0)r.default.checkArrIsEqual(a,l)&&i.push(a)}i.sort(),this.deleteQ=0,this.deleteR=0;for(var h=0;h<i.length;h++){var d=i[h];this.deleteNodeArr[h]=[];for(var u=0;u<d.length;u++){var p=d[u],f=this.boardFrameList[p];f.isFulled=!1,this.deleteNodeArr[h].push(f),0===h&&2===u&&(this.deleteAnimInitNode=f)}}i.length&&(this.scoreRule(i),this.deleteAnim()),this.isDeleting=!1},addDropScore:function(e){this.scoreAnim(e,this.dropScore)},deleteAnim:function(){var e=this;if(this.deleteNodeArr[this.deleteAnimCount]){for(var t=this.deleteNodeArr[this.deleteAnimCount].length,i=this.dropScore,o=0;o<this.deleteAnimCount+1;o++)i+=this.deleteScoreArr[o];this.scoreAnim(null,i,this.deleteNodeArr.length-1!==this.deleteAnimCount),this.deleteNodeArr[this.deleteAnimCount].forEach(function(i,o){e.nodeDelete(i,o,t)})}},scoreAnim:function(e,t,i){var o=this,r=(e||this.deleteAnimInitNode).convertToWorldSpaceAR(cc.v2(0,0)),s=cc.find("Canvas/dropScore"),c=s.parent.convertToNodeSpaceAR(r);s.setPosition(c),s.scale=1.5,s.getComponent(cc.Label).string=t,s.runAction(cc.sequence(cc.scaleTo(.3,2.5).easing(cc.easeBackOut()),cc.scaleTo(.1,2),cc.callFunc(function(e){!0!==i&&e.runAction(cc.spawn(cc.moveBy(.3,0,100),cc.scaleTo(.3,0),cc.callFunc(function(e){n+=t,cc.find("Canvas/Score").getComponent(cc.Label).string=n,o.checkLose()})))})))},nodeDelete:function(e,t,i){var o=this,r=e.getChildByName("fillNode"),n=cc.callFunc(function(){r.getComponent(cc.Sprite).spriteFrame=null,r.opacity=255,t===i-1&&(o.deleteAnimCount++,o.deleteAnim())},this);r.runAction(cc.sequence(cc.fadeOut(.5),n))},scoreRule:function(e){var t=this;this.deleteScoreArr=[];var i=0;if(e&&e.length){switch(e.length){case 1:this.deleteScoreArr[0]=20*e[0].length,i+=20*e[0].length;break;case 2:case 3:var o=0;e.forEach(function(e,i){t.deleteScoreArr[i]=30*e.length,o+=e.length}),i+=30*o}console.log("this.deleteScoreArr:",this.deleteScoreArr)}return i},checkLose:function(){for(var e=this.node.parent.getChildByName("TileContainer").children,t=e.length,i=0,o=0;o<t;o++){var r=e[o];r.getComponent("Shape").checkLose()?(i++,r.opacity=125,console.log(r.name,"\u65e0\u6cd5\u6446\u653e")):r.opacity=255}i===t&&(cc.sys.localStorage.getItem("score")<n&&cc.sys.localStorage.setItem("score",n),this.gameOver())},gameOver:function(){if(this.status){console.log("\u8f93\u4e86");var e=cc.find("Canvas/Failed");e.active=!0,e.runAction(cc.fadeIn(.3)),this.status=0}},setHexagonGrid:function(){var e=this;this.hexes=[],this._hexes=[],this.boardFrameList=[],this.hexSide--;for(var t=-this.hexSide;t<=this.hexSide;t++)for(var i=Math.max(-this.hexSide,-t-this.hexSide),o=Math.min(this.hexSide,-t+this.hexSide),r=i;r<=o;r++){var n=t+this.hexSide,s=r-i;this.hexes[n]||(this.hexes[n]=[]),this._hexes[n]||(this._hexes[n]=[]),this.hexes[n][s]=this.hex2pixel({q:t,r:r},this.tileH),this._hexes[n][s]={q:t,r:r}}this.hexes.forEach(function(t,i){e.setSpriteFrame(t,i)})},hex2pixel:function(e,t){var i=t/2,o=i*Math.sqrt(3)*(e.q+e.r/2),r=3*i/2*e.r;return cc.v2(o,r)},setSpriteFrame:function(e,t){for(var i=0;i<e.length;i++){var o=new cc.Node("frame");o.addComponent(cc.Sprite).spriteFrame=this.tilePic,o.x=e[i].x,o.y=e[i].y,o.scale=.7,o.parent=this.node,e[i].spriteFrame=o,this.setShadowNode(o),this.setFillNode(o),this.setWpos(o,this._hexes[t][i]),this.boardFrameList.push(o)}},setShadowNode:function(e){var t=new cc.Node("shadowNode");t.addComponent(cc.Sprite),t.opacity=150,t.parent=e},setFillNode:function(e){var t=new cc.Node("fillNode");t.addComponent(cc.Sprite),t.parent=e},setWpos:function(e,t){var i=e.convertToWorldSpaceAR(cc.v2(0,0));e.w_pos=i}}),cc._RF.pop()},{"./util/Util":"Util",Config:"Config"}],Config:[function(e,t,i){"use strict";cc._RF.push(t,"6c90aUK/DBJtZGoJqW6BWXM","Config"),Object.defineProperty(i,"__esModule",{value:!0});i.default={DelRules:[[0,1,2,3,4],[5,6,7,8,9,10],[11,12,13,14,15,16,17],[18,19,20,21,22,23,24,25],[26,27,28,29,30,31,32,33,34],[35,36,37,38,39,40,41,42],[43,44,45,46,47,48,49],[50,51,52,53,54,55],[56,57,58,59,60],[26,35,43,50,56],[18,27,36,44,51,57],[11,19,28,37,45,52,58],[5,12,20,29,38,46,53,59],[0,6,13,21,30,39,47,54,60],[1,7,14,22,31,40,48,55],[2,8,15,23,32,41,49],[3,9,16,24,33,42],[4,10,17,25,34],[0,5,11,18,26],[1,6,12,19,27,35],[2,7,13,20,28,36,43],[3,8,14,21,29,37,44,50],[4,9,15,22,30,38,45,51,56],[10,16,23,31,39,46,52,57],[17,24,32,40,47,53,58],[25,33,41,48,54,59],[34,42,49,55,60]],Tiles:[{type:1,list:[[[0,0]]]},{type:2,list:[[[1,-1],[0,0],[1,0],[0,1]],[[0,0],[1,0],[-1,1],[0,1]],[[0,0],[1,0],[0,1],[1,1]]]},{type:3,list:[[[0,-1],[0,0],[0,1],[0,2]],[[0,0],[1,-1],[-1,1],[-2,2]],[[-1,0],[0,0],[1,0],[2,0]]]},{type:4,list:[[[0,0],[0,1],[0,-1],[-1,0]],[[0,0],[0,-1],[1,-1],[-1,1]],[[0,0],[0,1],[0,-1],[1,0]],[[0,0],[1,0],[-1,0],[1,-1]],[[0,0],[1,0],[-1,0],[-1,1]]]},{type:5,list:[[[0,0],[0,1],[0,-1],[1,-1]],[[0,0],[1,-1],[-1,1],[-1,0]],[[0,0],[1,-1],[-1,1],[1,0]],[[0,0],[1,0],[-1,0],[0,-1]],[[0,0],[1,0],[-1,0],[0,1]]]},{type:6,list:[[[0,-1],[-1,0],[-1,1],[0,1]],[[-1,0],[0,-1],[1,-1],[1,0]],[[0,-1],[1,-1],[1,0],[0,1]],[[-1,1],[0,1],[1,0],[1,-1]],[[-1,0],[-1,1],[0,-1],[1,-1]],[[-1,0],[-1,1],[0,1],[1,0]]]}]},t.exports=i.default,cc._RF.pop()},{}],Shape:[function(e,t,i){"use strict";cc._RF.push(t,"4063413ziFJ573EdtZfBjyf","Shape");var o=function(e){return e&&e.__esModule?e:{default:e}}(e("Board")),r=e("Config");var n=function(e,t){var i=Math.random();return e+Math.floor((t-e)*i)};cc.Class({extends:cc.Component,properties:{tileH:122,tileScale:.7,board:{default:null,type:o.default},type1:{default:null,type:cc.SpriteFrame},type2:{default:null,type:cc.SpriteFrame},type3:{default:null,type:cc.SpriteFrame},type4:{default:null,type:cc.SpriteFrame},type5:{default:null,type:cc.SpriteFrame},type6:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.setTile(),this.addTouchEvent()},setTile:function(){var e=this;this.tiles=r.Tiles;var t=this.random(),i=t.list.map(function(t){return e.hex2pixel(t,e.tileH)});this.setSpriteFrame(i,this["type"+t.type]),this.node.ox=this.node.x,this.node.oy=this.node.y,this.node.scale=this.tileScale},random:function(){this._shape=n(0,this.tiles.length);var e=this.tiles[this._shape];this._list=n(0,e.list.length);var t=e.list[this._list];return{type:e.type,list:t}},hex2pixel:function(e,t){var i=t/2,o=i*Math.sqrt(3)*(e[0]+e[1]/2),r=3*i/2*e[1];return cc.v2(o,r)},setSpriteFrame:function(e,t){for(var i=0;i<e.length;i++){var o=new cc.Node("frame");o.x=e[i].x,o.y=e[i].y,o.addComponent(cc.Sprite).spriteFrame=t,o.parent=this.node;var r=o.convertToWorldSpaceAR(cc.v2(0,0));o.w_pos=r,o.scale=.7}},addTouchEvent:function(){var e=this;this.node.on("touchstart",function(t){e.board.isDeleting||(e.node.y+=50,e.node.scale=.8,e.node.children.forEach(function(e){e.scale=.6}),e.boardTiles=[],e.fillTiles=[])}),this.node.on("touchmove",function(t){if(!e.board.isDeleting){var i=t.touch.getDelta(),o=i.x,r=i.y;e.node.x+=o,e.node.y+=r,e.checkCollision(t),e.checkCanDrop()?e.dropPrompt(!0):e.dropPrompt(!1)}}),this.node.on("touchend",function(){e.board.isDeleting||e.tileDrop()}),this.node.on("touchcancel",function(){e.board.isDeleting||e.tileDrop()})},tileDrop:function(){if(this.resetBoardFrames(),this.checkCanDrop()){for(var e=this.boardTiles,t=this.fillTiles,i=t.length,o=0;o<i;o++){var r=e[o],n=t[o],s=r.getChildByName("fillNode"),c=n.getComponent(cc.Sprite).spriteFrame;r.isFulled=!0,s.getComponent(cc.Sprite).spriteFrame=c,s.scale=.8,s.runAction(cc.scaleTo(.2,1))}this.resetTile(),this.board.dropSuccess(e[e.length-1])}else this.backSourcePos()},wposGetNode:function(e){var t=e.x,i=e.y;return this.board.boardFrameList.filter(function(e){return!e.isFulled&&Math.abs(e.w_pos.x-t)<=3&&Math.abs(e.w_pos.y-i)<=3})[0]},checkLose:function(){var e=this.node.children,t=(e.length,this.board.boardFrameList),i=t.length,o=[];e.forEach(function(e){return o.push(e.w_pos)});var r=[];o.forEach(function(e,t){o[t+1]&&r.push(o[t+1].sub(o[0]))});for(var n=!0,s=0;s<i;s++){var c=t[s];if(!c.isFulled){for(var a=[],l=0,h=r.length;l<h;l++){var d=c.w_pos.add(r[l]);a.push(this.wposGetNode(d))}if(0===a.length||a.every(function(e){return!!e})){console.log(this.node.name,"\u8fd8\u80fd\u73a9"),n=!1;break}}}return n},resetTile:function(){this.node.removeAllChildren(),this.node.x=this.node.ox,this.node.y=this.node.oy,this.node.scale=1,this.setTile()},backSourcePos:function(){this.node.scale=this.tileScale,this.node.x=this.node.ox,this.node.y=this.node.oy,this.node.children.forEach(function(e){e.scale=.7})},checkCollision:function(e){var t=this.node.children;this.boardTiles=[],this.fillTiles=[];for(var i=0;i<t.length;i++){var o=t[i],r=this.node.position.add(o.position),n=this.checkDistance(r);n&&(this.fillTiles.push(o),this.boardTiles.push(n))}},checkDistance:function(e){for(var t=this.board.boardFrameList,i=0;i<t.length;i++){var o=t[i];if(o.position.sub(e).mag()<=35)return o}},checkCanDrop:function(){var e=this.boardTiles,t=this.node.children,i=e.length,o=t.length;if(0===i||i!=o)return!1;for(var r=0;r<i;r++)if(this.boardTiles[r].isFulled)return!1;return!0},resetBoardFrames:function(){for(var e=this.board.boardFrameList,t=0;t<e.length;t++){e[t].getChildByName("shadowNode").opacity=0}},dropPrompt:function(e){var t=this.boardTiles,i=t.length,o=this.fillTiles;if(this.resetBoardFrames(),e)for(var r=0;r<i;r++){var n=t[r].getChildByName("shadowNode");n.opacity=100;var s=o[r].getComponent(cc.Sprite).spriteFrame;n.getComponent(cc.Sprite).spriteFrame=s}},start:function(){}}),cc._RF.pop()},{Board:"Board",Config:"Config"}],Util:[function(e,t,i){"use strict";cc._RF.push(t,"0f151PisGVJAKNTI3GsmFYp","Util"),Object.defineProperty(i,"__esModule",{value:!0});i.default={arrIntersect:function(e,t){for(var i=[],o=0;o<e.length;o++)for(var r=0;r<t.length;r++)t[r]==e[o]&&i.push(t[r]);return i},checkArrIsEqual:function(e,t){for(var i=0;i<e.length;i++)if(t[i]!=e[i])return!1;return!0}},t.exports=i.default,cc._RF.pop()},{}]},{},["Alert","Board","Config","Shape","Util"]);