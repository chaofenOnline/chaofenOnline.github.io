var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();!function(){function e(t,a,n){function i(r,s){if(!a[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=a[r]={exports:{}};t[r][0].call(u.exports,function(e){var a=t[r][1][e];return i(a||e)},u,u.exports,e,t,a,n)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameScene"),i=e("./game/GameCtrl"),o=e("./HomeScene"),r=e("./game/StairCtrl"),s=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("GameScene.ts",n["default"]),e("game/GameCtrl.ts",i["default"]),e("HomeScene.ts",o["default"]),e("game/StairCtrl.ts",r["default"])},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="vertical",e.alignV="top",e.alignH="left",e.startScene="GameScene.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a["default"]=s,s.init()},{"./GameScene":2,"./HomeScene":3,"./game/GameCtrl":6,"./game/StairCtrl":8}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./ui/layaMaxUI"),i=e("./game/GameCtrl"),o=e("./game/CameraCtrl"),r=function(e){function t(){var a=e.call(this)||this;t.instance=a;var n=a.gameBox.addChild(new Laya.Scene3D);n.name="game_scene",n.enableFog=!0,n.fogColor=new Laya.Vector3(0,0,.4),n.fogStart=5,n.fogRange=15;var i=n.addChild(new Laya.Sprite3D);i.name="CameraBox",i.addComponent(o["default"]);var r=i.addChild(new Laya.Camera(0,.3,100));r.transform.localRotation=new Laya.Quaternion(0,.9864828924223251,.16386428213031506,0),r.transform.localPosition=new Laya.Vector3(0,4.74,-4.6);var s=n.addChild(new Laya.DirectionLight);return s.transform.localPosition=new Laya.Vector3(0,3,0),s.transform.localRotation=new Laya.Quaternion(.19700438504498596,.8332159367488392,.5012670619477712,-.1251870904967867),a.directionLight=s,s.shadow=!0,s.shadowDistance=30,s.shadowResolution=2048,s.shadowPSSMCount=1,s.shadowPCFType=1,a}return __extends(t,e),t.prototype.onEnable=function(){console.log("游戏场景打开"),this.btnHome.on(Laya.Event.MOUSE_DOWN,this,this.backHome),this.btnStart.on(Laya.Event.MOUSE_DOWN,this,this.gameStart),i["default"].instance.enabled=!0},t.prototype.onDisable=function(){console.log("游戏场景关闭"),this.gameBox.removeChildren()},t.prototype.backHome=function(){Laya.Scene.open("HomeScene.scene")},t.prototype.gameStart=function(){return 3==i["default"].instance.state?void Laya.Scene.open("GameScene.scene"):void(1!=i["default"].instance.state?(this.btnStart.label="暂停",i["default"].instance.gameStart()):(this.btnStart.label="开始",i["default"].instance.gamePause()))},t.prototype.gamePause=function(){i["default"].instance.gamePause()},t.prototype.addScore=function(){this.score.changeText(i["default"].instance._score.toString())},t}(n.ui.GameSceneUI);a["default"]=r},{"./game/CameraCtrl":5,"./game/GameCtrl":6,"./ui/layaMaxUI":9}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./ui/layaMaxUI"),i=function(e){function t(){var t=e.call(this)||this;return t.intType=1e3,t.numType=1e3,t.strType="hello laya",t.boolType=!0,t.btnStart.on(Laya.Event.MOUSE_DOWN,t,t.open3DScene),t}return __extends(t,e),t.prototype.onEnable=function(){},t.prototype.onDisable=function(){},t.prototype.open3DScene=function(){Laya.Scene.open("GameScene.scene")},t}(n.ui.HomeSceneUI);a["default"]=i},{"./ui/layaMaxUI":9}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameConfig"),i=function(){function e(){window.Laya3D?Laya3D.init(n["default"].width,n["default"].height):Laya.init(n["default"].width,n["default"].height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n["default"].scaleMode,Laya.stage.screenMode=n["default"].screenMode,Laya.URL.exportSceneToJson=n["default"].exportSceneToJson,(n["default"].debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n["default"].physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n["default"].stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){n["default"].startScene&&Laya.Scene.open(n["default"].startScene)},e}();new i},{"./GameConfig":1}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameCtrl"),i=e("./PlayerCtrl"),o=function(e){function t(){var a=e.call(this)||this;return a.cameraSpeed=15,t.instance=a,console.log("摄像机脚本构造函数"),a}return __extends(t,e),t.prototype.onEnable=function(){console.log("摄像机脚本启用"),this.camera=this.owner,this.initPos=this.camera.transform.localPosition},t.prototype.onDisable=function(){console.log("摄像机脚本禁用")},t.prototype.onUpdate=function(){1===n["default"].instance.state&&(this.initPos.y+=.5/this.cameraSpeed/2,this.initPos.z+=2/this.cameraSpeed/2,this.camera.transform.localPosition=new Laya.Vector3(i["default"].instance.initPos.x/3,this.initPos.y,this.initPos.z))},t}(Laya.Script);a["default"]=o},{"./GameCtrl":6,"./PlayerCtrl":7}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./PlayerCtrl"),i=e("./CameraCtrl"),o=e("./StairCtrl"),r=e("./../GameScene"),s=function(e){function t(){var a=e.call(this)||this;return a.stairNum=0,a.state=0,a._score=0,t.instance=a,console.log("游戏主逻辑脚本"),a}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,r["default"].instance.addScore()},enumerable:!0,configurable:!0}),t.prototype.onEnable=function(){console.log("游戏主逻辑脚本启用"),this.game_scene=this.owner.getChildByName("gameBox").getChildByName("game_scene"),this.CameraBox=this.game_scene.getChildByName("CameraBox"),this.stairBox=this.game_scene.addChild(new Laya.MeshSprite3D),this.stairBox.name="stairBox",this.init()},t.prototype.onDisable=function(){console.log("游戏主逻辑脚本禁用")},t.prototype.init=function(){this.createStairs(),this.createPlayer()},t.prototype.createPlayer=function(){this.CameraBox.getChildByName("player")&&this.CameraBox.getChildByName("player").removeSelf();var e=this.CameraBox.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(.2)));e.name="player",e.transform.localPosition=new Laya.Vector3(0,1.25,1.8);var t=new Laya.BlinnPhongMaterial;Laya.Texture2D.load("res/layabox.png",Laya.Handler.create(null,function(e){t.albedoTexture=e})),e.meshRenderer.material=t,e.meshRenderer.castShadow=!0,e.addComponent(n["default"]),this.player=e},t.prototype.createStairs=function(){this.stairBox.removeChildren();for(var e=0;10>e;e++){var t=this.stairBox.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(5.5,.5,2)));t.name="stair"+e,t.transform.localPosition=new Laya.Vector3(0,.25+.5*e,2*e),this.stairNum=e,t.meshRenderer.receiveShadow=!0,console.log(t.meshFilter);var a=t.addComponent(o["default"]);a.stairNum=e;var n=t.addChild(new Laya.MeshSprite3D);if(n.name="barrierBox",!(5>e))for(var i=Math.floor(4*Math.random())+1,r=0;i>r;r++){var s=this.createStairBarrier(a);n.addChild(s)}}},t.prototype.createStairBarrier=function(e){var t=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCone(.25,.5)),a=e.xArr.splice(Math.floor(Math.random()*e.xArr.length))[0];return t.transform.localPosition=new Laya.Vector3(a,.5,-0),t.name="barrier",t.meshRenderer.receiveShadow=!0,t},t.prototype.createNewStair=function(){this.stairBox._children[0].removeSelf();var e=Laya.Pool.getItem("stair");this.stairNum++;var t=e.getComponent(o["default"]);t.xArr=[-2,-1,0,1,2],t.stairNum=this.stairNum,e.name="stair"+this.stairNum,e._components[0].stairNum=this.stairNum,e.meshRenderer.receiveShadow=!0,e.transform.localPosition=new Laya.Vector3(0,.25+.5*this.stairNum,2*this.stairNum);var a=e.getChildByName("barrierBox");a&&a.removeChildren();for(var s=Math.floor(4*Math.random())+1,c=0;s>c;c++){var l=this.createStairBarrier(t);a.addChild(l)}this.stairBox.addChild(e),this.stairNum>20&&this.stairNum%10===0&&(n["default"].instance.jumpTime>8&&(n["default"].instance.jumpTime-=1),i["default"].instance.cameraSpeed>8&&(i["default"].instance.cameraSpeed-=1),r["default"].instance.directionLight.color=new Laya.Vector3(Math.random(),Math.random(),Math.random()),console.log("加速：",n["default"].instance.jumpTime,i["default"].instance.cameraSpeed))},t.prototype.gameStart=function(){this.state=1},t.prototype.gamePause=function(){this.state=2},t.prototype.gameOver=function(){var e=this;this.state=3,r["default"].instance.btnStart.label="重来",Laya.timer.once(500,this,function(){e.player.active=!1})},t}(Laya.Script);a["default"]=s},{"./../GameScene":2,"./CameraCtrl":5,"./PlayerCtrl":7,"./StairCtrl":8}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../GameScene"),i=e("./GameCtrl"),o=function(e){function t(){var a=e.call(this)||this;return a.jumpHeight=3,a.jumpTime=15,a._jumpFrame=0,a._isTouch=!1,a._touchPosX=0,a.jumpUp=!0,t.instance=a,console.log("玩家脚本构造函数"),a}return __extends(t,e),t.prototype.onEnable=function(){console.log("玩家脚本启用"),this.init()},t.prototype.onDisable=function(){console.log("玩家脚本禁用")},t.prototype.onMouseDown=function(){this._isTouch=!0,this._touchPosX=Laya.stage.mouseX},t.prototype.onMouseUp=function(){this._isTouch=!1},t.prototype.init=function(){n["default"].instance.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),n["default"].instance.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),this.player=this.owner,this.initPos=this.player.transform.localPosition,this._jumpFrame=0,this._jumpStartY=this.initPos.y},t.prototype.onUpdate=function(){if(1===i["default"].instance.state){if(this._isTouch&&this._touchPosX!=Laya.stage.mouseX){var e=Laya.stage.mouseX-this._touchPosX;e/=Laya.stage.width/2;var t=this.player.transform.localPosition.x+-2.5*e;2>t&&t>-2&&(this.initPos.x=t,this._touchPosX=Laya.stage.mouseX)}this._jumpFrame++,this.jumpUp?(this.initPos.y=this._jumpStartY+this.jumpHeight*Math.sin(this._jumpFrame/this.jumpTime*Math.PI/2),this._jumpFrame>=this.jumpTime&&(this._jumpFrame=0,this._jumpStartY=this.initPos.y,this.jumpUp=!1)):(this.initPos.y=this._jumpStartY-this.jumpHeight*(1-Math.cos(this._jumpFrame/this.jumpTime*Math.PI/2)),this.initPos.y<=2&&this.checkCollisionBarrier(),this._jumpFrame>=this.jumpTime&&(this._jumpFrame=0,this._jumpStartY=this.initPos.y,this.checkCollision(),this.jumpUp=!0,i["default"].instance.createNewStair(),i["default"].instance.score+=1)),this.player.transform.localPosition=new Laya.Vector3(this.initPos.x,this.initPos.y,this.initPos.z),this.player.transform.localRotationEulerX+=2}},t.prototype.checkCollisionBarrier=function(){var e=i["default"].instance.stairBox._children[2],t=this.player._render.boundingBox,a=e.getChildByName("barrierBox");if(a){var n=a._children.some(function(e){var a=e._render.boundingBox,n=a.min.x<=t.min.x&&t.min.x<=a.max.x,i=a.min.x<=t.max.x&&t.max.x<=a.max.x;return n||i});return n?(console.log("碰到障碍物了"),void i["default"].instance.gameOver()):void 0}},t.prototype.checkCollision=function(){var e=i["default"].instance.stairBox._children[2],t=this.player._render.boundingBox,a=e._render.boundingBox;return t.min.x+.2<a.min.x||t.max.x-.2>a.max.x?(console.log("没踩中楼梯"),void i["default"].instance.gameOver()):void 0},t}(Laya.Script);a["default"]=o},{"../GameScene":2,"./GameCtrl":6}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameCtrl"),i=function(e){function t(){var t=e.call(this)||this;return t.fire=!1,t.stairNum=0,t.moveFrame=0,t.moveTime=50,t.moveRight=!0,t.time=1,t.xArr=[-2,-1,0,1,2],t}return __extends(t,e),t.prototype.onEnable=function(){console.log(this.owner.name+" onEnable"),(this.stairNum&&this.stairNum%5===0||n["default"].instance.stairNum>40)&&(this.fire=!0,this.stair=this.owner)},t.prototype.onDisable=function(){Laya.Pool.recover("stair",this.owner)},t.prototype.onUpdate=function(){this.fire&&1===n["default"].instance.state&&(this.moveFrame++,this.moveRight?(this.stair.transform.localPositionX-=1/this.moveTime,this.moveFrame>=this.moveTime*this.time&&(this.moveFrame=0,this.moveRight=!1)):(this.stair.transform.localPositionX+=1/this.moveTime,this.moveFrame>=2*this.moveTime&&(1===this.time&&(this.time=2),this.moveFrame=0,this.moveRight=!0)))},t}(Laya.Script);a["default"]=i},{"./GameCtrl":6}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=Laya.ClassUtils.regClass;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("GameScene")},t}(Laya.Scene);e.GameSceneUI=t,i("ui.GameSceneUI",t);var a=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("HomeScene")},t}(Laya.Scene);e.HomeSceneUI=a,i("ui.HomeSceneUI",a)}(n=a.ui||(a.ui={}))},{}]},{},[4]);