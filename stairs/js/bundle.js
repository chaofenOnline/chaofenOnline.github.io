var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function o(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();!function(){function e(a,t,o){function r(n,s){if(!t[n]){if(!a[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(i)return i(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var h=t[n]={exports:{}};a[n][0].call(h.exports,function(e){var t=a[n][1][e];return r(t||e)},h,h.exports,e,a,t,o)}return t[n].exports}for(var i="function"==typeof require&&require,n=0;n<o.length;n++)r(o[n]);return r}return e}()({1:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./GameScene"),r=e("./game/GameCtrl"),i=e("./HomeScene"),n=e("./game/StairCtrl"),s=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("GameScene.ts",o["default"]),e("game/GameCtrl.ts",r["default"]),e("HomeScene.ts",i["default"]),e("game/StairCtrl.ts",n["default"])},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="vertical",e.alignV="top",e.alignH="left",e.startScene="GameScene.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();t["default"]=s,s.init()},{"./GameScene":2,"./HomeScene":3,"./game/GameCtrl":7,"./game/StairCtrl":9}],2:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./ui/layaMaxUI"),r=e("./game/GameCtrl"),i=e("./game/CameraCtrl"),n=function(e){function a(){var t=e.call(this)||this;a.instance=t;var o=t.gameBox.addChild(new Laya.Scene3D);o.name="game_scene",o.enableFog=!0,o.fogColor=new Laya.Vector3(1,1,1),o.fogStart=10,o.fogRange=15;var r=o.addChild(new Laya.Sprite3D);r.name="CameraBox",r.addComponent(i["default"]);var n=r.addChild(new Laya.Camera(0,.3,100));n.transform.localRotation=new Laya.Quaternion(0,.9864828924223251,.16386428213031506,0),n.transform.localPosition=new Laya.Vector3(0,4.74,-4),n.clearColor=new Laya.Vector4(1,1,1,1);var s=o.addChild(new Laya.DirectionLight);return s.transform.localPosition=new Laya.Vector3(0,3,0),s.transform.localRotation=new Laya.Quaternion(.19700438504498596,.8332159367488392,.5012670619477712,-.1251870904967867),s.color=new Laya.Vector3(1,1,1),t.directionLight=s,s.shadow=!0,s.shadowDistance=15,s.shadowResolution=2048,s.shadowPSSMCount=1,s.shadowPCFType=1,t}return __extends(a,e),a.prototype.onEnable=function(){console.log("游戏场景打开"),this.btnHome.on(Laya.Event.MOUSE_DOWN,this,this.backHome),this.btnStart.on(Laya.Event.MOUSE_DOWN,this,this.gameStart),r["default"].instance.enabled=!0},a.prototype.onDisable=function(){console.log("游戏场景关闭"),this.gameBox.removeChildren(),Laya.Scene.gc(),Laya.Resource.destroyUnusedResources()},a.prototype.backHome=function(){Laya.Scene.open("HomeScene.scene")},a.prototype.gameStart=function(){return 3==r["default"].instance.state?void Laya.Scene.open("GameScene.scene"):void(1!=r["default"].instance.state?(this.btnStart.label="暂停",r["default"].instance.gameStart()):(this.btnStart.label="开始",r["default"].instance.gamePause()))},a.prototype.gamePause=function(){r["default"].instance.gamePause()},a.prototype.addScore=function(){this.score.changeText(r["default"].instance._score.toString())},a}(o.ui.GameSceneUI);t["default"]=n},{"./game/CameraCtrl":6,"./game/GameCtrl":7,"./ui/layaMaxUI":10}],3:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./ui/layaMaxUI"),r=function(e){function a(){var a=e.call(this)||this;return a.intType=1e3,a.numType=1e3,a.strType="hello laya",a.boolType=!0,a.btnStart.on(Laya.Event.MOUSE_DOWN,a,a.open3DScene),a}return __extends(a,e),a.prototype.onEnable=function(){},a.prototype.onDisable=function(){},a.prototype.open3DScene=function(){Laya.Scene.open("GameScene.scene")},a}(o.ui.HomeSceneUI);t["default"]=r},{"./ui/layaMaxUI":10}],4:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./GameConfig"),r=function(){function e(){window.Laya3D?Laya3D.init(o["default"].width,o["default"].height):Laya.init(o["default"].width,o["default"].height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=o["default"].scaleMode,Laya.stage.screenMode=o["default"].screenMode,Laya.URL.exportSceneToJson=o["default"].exportSceneToJson,(o["default"].debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),o["default"].physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),o["default"].stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){o["default"].startScene&&Laya.Scene.open(o["default"].startScene)},e}();new r},{"./GameConfig":1}],5:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.StairColorList=[new Laya.Vector4(.3726415,.7586222,1,1),new Laya.Vector4(1,.6286876,0,1),new Laya.Vector4(.536453,.4103774,1,1),new Laya.Vector4(.4410169,.83,0,1)],e.StairColor=e.StairColorList[0],e.BarrierXList=[-2,-1,0,1,2],e}();t["default"]=o},{}],6:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./GameCtrl"),r=e("./PlayerCtrl"),i=function(e){function a(){var t=e.call(this)||this;return t.cameraSpeed=15,t._isShake=!1,a.instance=t,console.log("摄像机脚本构造函数"),t}return __extends(a,e),a.prototype.onEnable=function(){console.log("摄像机脚本启用"),this.camera=this.owner,this.initPos=this.camera.transform.localPosition},a.prototype.onDisable=function(){console.log("摄像机脚本禁用")},a.prototype.moveRight=function(){},a.prototype.cameraShake=function(){var e=this;console.log("震屏");var a=this.camera.transform.localPosition;Laya.Tween.to(this.camera.transform,{localPositionX:this.camera.transform.localPositionX+Math.random(),localPositionY:this.camera.transform.localPositionY+Math.random()},100,Laya.Ease.linearInOut,Laya.Handler.create(this,function(t){Laya.Tween.to(e.camera.transform,{localPositionX:e.camera.transform.localPositionX-Math.random(),localPositionY:e.camera.transform.localPositionY-Math.random()},100,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.camera.transform,{localPositionX:e.camera.transform.localPositionX+Math.random(),localPositionY:e.camera.transform.localPositionY+Math.random()},100,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.camera.transform,{localPositionX:e.camera.transform.localPositionX+Math.random(),localPositionY:e.camera.transform.localPositionY+Math.random()},150,Laya.Ease.linearInOut,Laya.Handler.create(e,function(t){Laya.Tween.to(e.camera.transform,{localPositionX:e.camera.transform.localPositionX-Math.random(),localPositionY:e.camera.transform.localPositionY-Math.random()},250,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.camera.transform,{localPositionX:e.camera.transform.localPositionX+Math.random(),localPositionY:e.camera.transform.localPositionY+Math.random()},500,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){e.camera.transform.localPosition=a}))}))}))}))}))}))},a.prototype.onUpdate=function(){1===o["default"].instance.state&&(this.initPos.y+=.5/this.cameraSpeed/2,this.initPos.z+=2/this.cameraSpeed/2,this.camera.transform.localPosition=new Laya.Vector3(r["default"].instance.initPos.x/3,this.initPos.y,this.initPos.z))},a}(Laya.Script);t["default"]=i},{"./GameCtrl":7,"./PlayerCtrl":8}],7:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./PlayerCtrl"),r=e("./CameraCtrl"),i=e("./StairCtrl"),n=e("./../GameScene"),s=e("../config/GameConfig"),l=function(e){function a(){var t=e.call(this)||this;return t.stairNum=-1,t.state=0,t._score=0,t.scoreCombo=!1,a.instance=t,console.log("游戏主逻辑脚本"),t}return __extends(a,e),Object.defineProperty(a.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,n["default"].instance.addScore()},enumerable:!0,configurable:!0}),a.prototype.onEnable=function(){console.log("游戏主逻辑脚本启用"),this.game_scene=this.owner.getChildByName("gameBox").getChildByName("game_scene"),this.CameraBox=this.game_scene.getChildByName("CameraBox"),this.stairBox=this.game_scene.addChild(new Laya.MeshSprite3D),this.stairBox.name="stairBox",this.init()},a.prototype.onDisable=function(){console.log("游戏主逻辑脚本禁用")},a.prototype.init=function(){s["default"].StairColor=s["default"].StairColorList[0];for(var e=0;10>e;e++){var a=Laya.Pool.getItem("stair");a?this.stairBox.addChild(a):this.createStairs()}this.createPlayer()},a.prototype.createPlayer=function(){this.CameraBox.getChildByName("player")&&this.CameraBox.getChildByName("player").removeSelf();var e=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(.2));e.name="player";var a=new Laya.BlinnPhongMaterial;Laya.Texture2D.load("res/layabox.png",Laya.Handler.create(null,function(e){a.albedoTexture=e})),e.meshRenderer.material=a,e.meshRenderer.castShadow=!0,e.addComponent(o["default"]),this.CameraBox.addChild(e),this.player=e},a.prototype.createStairs=function(){var e=this.stairBox.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(5.5,.5,2))),a=new Laya.MeshSprite3D;a.name="barrierBox",e.addChild(a),e.addComponent(i["default"])},a.prototype.createNewStair=function(){var e=this;this.stairBox._children[0].removeSelf();var a=Laya.Pool.getItem("stair");a?this.stairBox.addChild(a):this.createStairs(),this.stairNum>20&&this.stairNum%10===0&&(o["default"].instance.jumpTime>8&&(o["default"].instance.jumpTime-=1),r["default"].instance.cameraSpeed>8&&(r["default"].instance.cameraSpeed-=1),s["default"].StairColor=s["default"].StairColorList[Math.floor(Math.random()*s["default"].StairColorList.length)],this.stairBox._children.forEach(function(a,t){Laya.timer.once(50*t,e,function(){a.meshRenderer.material.albedoColor=s["default"].StairColor})}),console.log("加速：",o["default"].instance.jumpTime,r["default"].instance.cameraSpeed))},a.prototype.changeScoreCylinderAlpha=function(e){e!==this.scoreCombo&&(this.scoreCombo=e,this.stairBox._children.forEach(function(a){if(a.getChildByName("scoreCylinder")){var t=e?1:.8;a.getChildByName("scoreCylinder")._render.materials[0].albedoColor=new Laya.Vector4(t,t,t,1)}}))},a.prototype.gameStart=function(){this.state=1},a.prototype.gamePause=function(){this.state=2},a.prototype.gameOver=function(){var e=this;this.state=3,r["default"].instance.cameraShake(),n["default"].instance.btnStart.label="重来";var a=this.player.transform.localPosition;this.player.removeSelf(),Laya.loader.create("res/dead_particle/000.lh",Laya.Handler.create(this,function(t){var o=t._children[0].clone();console.log(o),o.name="dead_particle",o.transform.localPosition=a,o.transform.localScale=new Laya.Vector3(.01,.01,.01),e.CameraBox.addChild(o),Laya.timer.once(1,e,function(){o._particleSystem})}))},a}(Laya.Script);t["default"]=l},{"../config/GameConfig":5,"./../GameScene":2,"./CameraCtrl":6,"./PlayerCtrl":8,"./StairCtrl":9}],8:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("../GameScene"),r=e("./GameCtrl"),i=function(e){function a(){var t=e.call(this)||this;return t.jumpHeight=2,t.jumpTime=15,t._jumpFrame=0,t._isTouch=!1,t._touchPosX=0,t.jumpUp=!0,a.instance=t,console.log("玩家脚本构造函数"),t}return __extends(a,e),a.prototype.onEnable=function(){console.log("玩家脚本启用"),this.owner.transform.localPosition=new Laya.Vector3(0,1.25,1.8),this.init()},a.prototype.onDisable=function(){console.log("玩家脚本禁用")},a.prototype.onMouseDown=function(){this._isTouch=!0,this._touchPosX=Laya.stage.mouseX},a.prototype.onMouseUp=function(){this._isTouch=!1},a.prototype.init=function(){o["default"].instance.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),o["default"].instance.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),this.player=this.owner,this.initPos=this.player.transform.localPosition,this._jumpFrame=0,this._jumpStartY=this.initPos.y},a.prototype.onUpdate=function(){if(1===r["default"].instance.state){if(this._isTouch&&this._touchPosX!=Laya.stage.mouseX){var e=Laya.stage.mouseX-this._touchPosX;e/=Laya.stage.width/2;var a=this.player.transform.localPosition.x+-2.5*e;2>a&&a>-2&&(this.initPos.x=a,this._touchPosX=Laya.stage.mouseX)}this._jumpFrame++,this.jumpUp?(this.initPos.y=this._jumpStartY+this.jumpHeight*Math.sin(this._jumpFrame/this.jumpTime*Math.PI/2),this._jumpFrame>=this.jumpTime&&(this._jumpFrame=0,this._jumpStartY=this.initPos.y,this.jumpUp=!1)):(this.initPos.y=this._jumpStartY-this.jumpHeight*(1-Math.cos(this._jumpFrame/this.jumpTime*Math.PI/2)),this.initPos.y<=1.5&&this.checkCollisionBarrier(),this._jumpFrame>=this.jumpTime&&(this._jumpFrame=0,this._jumpStartY=this.initPos.y,this.checkCollision(),this.judgeScoreAdd(),this.jumpUp=!0,r["default"].instance.createNewStair())),this.player.transform.localPosition=new Laya.Vector3(this.initPos.x,this.initPos.y,this.initPos.z),this.player.transform.localRotationEulerX+=2}},a.prototype.judgeScoreAdd=function(){var e=r["default"].instance.stairBox._children[2],a=e.getChildByName("scoreCylinder"),t=1;if(a){var o=a._render.boundingBox,i=this.player._render.boundingBox,n=Math.abs(Math.abs(i.min.x)-Math.abs(o.min.x));.05>=n?t=5:.1>=n?t=4:.15>=n?t=3:.2>=n&&(t=2),console.log("距离：",Math.abs(i.min.x)-Math.abs(o.min.x)," 得分：",t)}t>1&&a.removeSelf(),r["default"].instance.changeScoreCylinderAlpha(t>1?!0:!1),r["default"].instance.score+=t},a.prototype.checkCollisionBarrier=function(){var e=r["default"].instance.stairBox._children[2],a=this.player._render.boundingBox,t=e.getChildByName("barrierBox");if(t){var o=t._children.some(function(e){var t=e._render.boundingBox,o=t.min.x<=a.min.x&&a.min.x<=t.max.x,r=t.min.x<=a.max.x&&a.max.x<=t.max.x;return o||r});return o?(console.log("碰到障碍物了"),void r["default"].instance.gameOver()):void 0}},a.prototype.checkCollision=function(){var e=r["default"].instance.stairBox._children[2],a=this.player._render.boundingBox,t=e._render.boundingBox;return a.min.x+.2<t.min.x||a.max.x-.2>t.max.x?(console.log("没踩中楼梯"),void r["default"].instance.gameOver()):void 0},a}(Laya.Script);t["default"]=i},{"../GameScene":2,"./GameCtrl":7}],9:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./GameCtrl"),r=e("../config/GameConfig"),i=function(e){function a(){var a=e.call(this)||this;return a.fire=!1,a.moveFrame=0,a.moveTime=50,a.moveRight=!0,a.time=1,a.xArr=[-2,-1,0,1,2],a}return __extends(a,e),a.prototype.onEnable=function(){this.xArr=r["default"].BarrierXList.concat(),o["default"].instance.stairNum++,this.stair=this.owner,o["default"].instance.stairNum&&o["default"].instance.stairNum%5===0&&(this.fire=!0);var e=new Laya.BlinnPhongMaterial;if(e.albedoColor=r["default"].StairColor,this.stair.meshRenderer.material=e,this.stair.name="stair"+o["default"].instance.stairNum,this.stair.transform.localPosition=new Laya.Vector3(0,.25+.5*o["default"].instance.stairNum,2*o["default"].instance.stairNum),this.stair.meshRenderer.receiveShadow=!0,console.log(this.owner.name+" 脚本 onEnable"),this.clearAgain(),!(o["default"].instance.stairNum<5)){this.createScoreCylinder();for(var a=Math.floor(4*Math.random())+1,t=0;a>t;t++){var i=this.createStairBarrier();this.stair.getChildByName("barrierBox").addChild(i)}}},a.prototype.onDisable=function(){console.log(this.stair.name,"disabled"),this.fire=!1,this.stair.getChildByName("barrierBox")&&(this.stair.getChildByName("barrierBox")._children.forEach(function(e){Laya.Pool.recover("barrier",e),e.removeSelf()}),Laya.Pool.recover("barrierBox",this.stair.getChildByName("barrierBox")),this.stair.getChildByName("barrierBox").removeSelf()),this.stair.getChildByName("scoreCylinder")&&Laya.Pool.recover("scoreCylinder",this.stair.getChildByName("scoreCylinder")),Laya.Pool.recover("stair",this.stair)},a.prototype.clearAgain=function(){if(this.stair.getChildByName("barrierBox"))this.stair.getChildByName("barrierBox")._children.forEach(function(e){Laya.Pool.recover("barrier",e),e.removeSelf()});else{var e=Laya.Pool.getItem("barrierBox");e||(e=new Laya.MeshSprite3D,e.name="barrierBox"),this.stair.addChild(e)}this.stair.getChildByName("barrierBox").removeChildren(),this.stair.getChildByName("scoreCylinder")&&this.stair.getChildByName("scoreCylinder").removeSelf()},a.prototype.createStairBarrier=function(){var e=this.xArr.splice(Math.floor(Math.random()*this.xArr.length),1)[0],a=Laya.Pool.getItem("barrier");if(!a){a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCone(.2,.5));var t=new Laya.BlinnPhongMaterial;t.albedoColor=new Laya.Vector4(.004672484,.08848506,.1415094,1),a.meshRenderer.material=t,a.name="barrier",a.meshRenderer.receiveShadow=!0;var o=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(.25,.05));o.meshRenderer.material=t,o.meshRenderer.receiveShadow=!0,o.transform.localPosition=new Laya.Vector3(0,-0.275,0),a.addChild(o)}return a.transform.localPosition=new Laya.Vector3(e,.55,0),a},a.prototype.createScoreCylinder=function(){console.log(this.owner.name,"创建分数块");var e=Laya.Pool.getItem("scoreCylinder");if(!e){e=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(.25,.01));var a=new Laya.BlinnPhongMaterial;e.meshRenderer.material=a,a.albedoColor=new Laya.Vector4(.8,.8,.8,1),e.name="scoreCylinder",e.transform.localPosition=new Laya.Vector3(0,.25,0),e.meshRenderer.receiveShadow=!0}var t=this.xArr.splice(Math.floor(3*Math.random())+1,1)[0];e.transform.localPositionX=t,this.stair.addChild(e)},a.prototype.onUpdate=function(){this.fire&&1===o["default"].instance.state&&(this.moveFrame++,this.moveRight?(this.stair.transform.localPositionX-=1/this.moveTime,this.moveFrame>=this.moveTime*this.time&&(this.moveFrame=0,this.moveRight=!1)):(this.stair.transform.localPositionX+=1/this.moveTime,this.moveFrame>=2*this.moveTime&&(1===this.time&&(this.time=2),this.moveFrame=0,this.moveRight=!0)))},a}(Laya.Script);t["default"]=i},{"../config/GameConfig":5,"./GameCtrl":7}],10:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=Laya.ClassUtils.regClass;!function(e){var a=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("GameScene")},a}(Laya.Scene);e.GameSceneUI=a,r("ui.GameSceneUI",a);var t=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("HomeScene")},a}(Laya.Scene);e.HomeSceneUI=t,r("ui.HomeSceneUI",t)}(o=t.ui||(t.ui={}))},{}]},{},[4]);