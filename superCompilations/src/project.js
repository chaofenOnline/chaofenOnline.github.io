window.__require=function e(t,o,r){function i(s,c){if(!o[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<r.length;s++)i(r[s]);return i}({Board:[function(e,t,o){"use strict";cc._RF.push(t,"4a466EjV7tPA6b0e4+H77EJ","Board");var r=e("Config"),i=function(e){return e&&e.__esModule?e:{default:e}}(e("./Util"));cc.Class({extends:cc.Component,properties:{hexSide:5,tileH:110,tilePic:{default:null,type:cc.SpriteFrame},dropScore:20,scoreLabel:cc.Label,oldScoreLabel:cc.Label,dropScoreLabel:cc.Label,FailedModal:cc.Node},reset:function(){this.status=1,this.boardFrameList.forEach(function(e){e.isFulled=void 0;var t=e.getChildByName("fillNode");t.getComponent(cc.Sprite).spriteFrame=null,t.opacity=255}),this.curScore=0,this.scoreLabel.string="0"},onLoad:function(){this.init()},getOldScore:function(){var e=cc.sys.localStorage.getItem("score");this.oldScoreLabel.string=e||"0"},dropSuccess:function(e){this.deleteAnimInitNode=null,this.deleteAnimCount=0,this.deleteNodeArr=[];var t=[],o=[],n=this.boardFrameList;this.isDeleting=!0;for(var s=0;s<n.length;s++){n[s].isFulled&&t.push(s)}for(var c=0;c<r.DelRules.length;c++){var a=r.DelRules[c],h=i.default.arrIntersect(t,a);if(h.length>0)i.default.checkArrIsEqual(a,h)&&o.push(a)}if(this.shouldAddScore=0,o.length){o.sort(function(e,t){return e.length-t.length}),console.log(o.length+"\u6d88\uff0c",o);for(var l=0;l<o.length;l++){var d=o[l];this.deleteNodeArr[l]=[];for(var u=0;u<d.length;u++){var p=d[u],f=this.boardFrameList[p];f.isFulled=!1,this.deleteNodeArr[l].push(f),0===l&&2===u&&(this.deleteAnimInitNode=f)}}this.scoreRule(o),this.deleteAnim()}else this.addDropScore(e)},addDropScore:function(e){this.addDropScoreAnim(e)},addDropScoreAnim:function(e,t){var o=this,r=e.convertToWorldSpaceAR(cc.v2(0,0)),i=this.dropScoreLabel.node,n=i.parent.convertToNodeSpaceAR(r);i.setPosition(n),i.scale=1.5,i.opacity=255,this.shouldAddScore=t||this.dropScore,this.dropScoreLabel.string=this.shouldAddScore,this.scoreLabel.node.runAction(cc.scaleTo(.3,1.5)),this.scoreAnimDt=0,this.score_fired=!0,this.isDeleting=!1,i.runAction(cc.sequence(cc.scaleTo(.3,2.5).easing(cc.easeBackOut()),cc.scaleTo(.1,2),cc.delayTime(.3),cc.spawn(cc.moveBy(.3,0,100),cc.fadeOut(.3),cc.callFunc(function(e){o.checkLose()}))))},comboScoreAnim:function(e,t,o){var r=this,i=e.convertToWorldSpaceAR(cc.v2(0,0)),n=this.dropScoreLabel.node,s=n.parent.convertToNodeSpaceAR(i);n.setPosition(s),n.scale=1.5,n.opacity=255,this.shouldAddScore=t||this.dropScore,this.dropScoreLabel.string=this.shouldAddScore,console.log("\u83b7\u5f97\u5206\u6570\uff1a",this.shouldAddScore),this.scoreLabel.node.runAction(cc.scaleTo(.3,1.5)),this.scoreAnimDt=0,this.score_fired=!0,n.runAction(cc.sequence(cc.scaleTo(.3,2.5),cc.scaleTo(.1,2)));var c=this.deleteNodeArr[this.deleteAnimCount].length;this.deleteNodeArr[this.deleteAnimCount].forEach(function(e,t){r.nodeDelete(e,t,c)}),o&&(n.stopAllActions(),n.runAction(cc.sequence(cc.scaleTo(.3,3),cc.scaleTo(.1,2.5),cc.delayTime(.3),cc.spawn(cc.moveBy(.3,0,100),cc.fadeOut(.3),cc.callFunc(function(e){r.checkLose()})))))},deleteAnim:function(){var e=this;if(1===this.deleteScoreArr.length)this.shouldAddScore=this.deleteScoreArr[0]+this.dropScore,this.addDropScoreAnim(this.deleteAnimInitNode,this.shouldAddScore),this.deleteNodeArr[0].forEach(function(t,o){e.nodeDelete(t,o,0)});else if(this.deleteNodeArr[this.deleteAnimCount]){var t=0===this.deleteAnimCount?this.dropScore:0,o=this.deleteScoreArr[this.deleteAnimCount];this.shouldAddScore+=t+o,console.log("\u7b2c"+(this.deleteAnimCount+1)+"\u6d88\uff1a"+this.shouldAddScore),this.comboScoreAnim(this.deleteAnimInitNode,this.shouldAddScore,this.deleteNodeArr.length-1===this.deleteAnimCount)}},nodeDelete:function(e,t,o){var r=this,i=e.getChildByName("fillNode"),n=cc.callFunc(function(){i.getComponent(cc.Sprite).spriteFrame=null,i.opacity=255,t===o-1&&(r.deleteAnimCount++,r.deleteAnim())},this);i.runAction(cc.sequence(cc.fadeOut(.5),n))},scoreRule:function(e){this.deleteScoreArr=[];var t=e.length;if(e&&t){switch(t){case 1:this.deleteScoreArr[0]=20*e[0].length;break;case 2:this.deleteScoreArr[0]=30*e[0].length,this.deleteScoreArr[1]=30*e[1].length;break;case 3:this.deleteScoreArr[0]=40*e[0].length,this.deleteScoreArr[1]=40*e[1].length,this.deleteScoreArr[2]=91*e[2].length;break;case 4:this.deleteScoreArr[0]=50*e[0].length,this.deleteScoreArr[1]=50*e[1].length,this.deleteScoreArr[2]=100*e[2].length,this.deleteScoreArr[3]=163*e[2].length;break;case 5:this.deleteScoreArr[0]=60*e[0].length,this.deleteScoreArr[1]=60*e[1].length,this.deleteScoreArr[2]=137*e[2].length,this.deleteScoreArr[3]=224*e[2].length,this.deleteScoreArr[4]=316*e[2].length;break;case 6:this.deleteScoreArr[0]=70*e[0].length,this.deleteScoreArr[1]=70*e[1].length,this.deleteScoreArr[2]=152*e[2].length,this.deleteScoreArr[3]=290*e[2].length,this.deleteScoreArr[4]=520*e[2].length,this.deleteScoreArr[5]=730*e[2].length;break;case 7:this.deleteScoreArr[0]=80*e[0].length,this.deleteScoreArr[1]=80*e[1].length,this.deleteScoreArr[2]=177*e[2].length,this.deleteScoreArr[3]=363*e[2].length,this.deleteScoreArr[4]=607*e[2].length,this.deleteScoreArr[5]=963*e[2].length,this.deleteScoreArr[6]=1300*e[2].length;break;case 8:this.deleteScoreArr[0]=90*e[0].length,this.deleteScoreArr[1]=90*e[1].length,this.deleteScoreArr[2]=200*e[2].length,this.deleteScoreArr[3]=480*e[2].length,this.deleteScoreArr[4]=782*e[2].length,this.deleteScoreArr[5]=1300*e[2].length,this.deleteScoreArr[6]=2008*e[2].length,this.deleteScoreArr[7]=2900*e[2].length}console.log("this.deleteScoreArr:",this.deleteScoreArr)}},checkLose:function(e){for(var t=this.node.parent.getChildByName("TileContainer").children,o=t.length,r=0,i=0;i<o;i++){var n=t[i];n.getComponent("hexCreator").checkLose()?(r++,n.opacity=125,console.log(n.name,"\u65e0\u6cd5\u6446\u653e")):n.opacity=255}if(!e){if(r===o)return cc.sys.localStorage.getItem("score")<this.curScore&&cc.sys.localStorage.setItem("score",this.curScore),void this.gameOver();this.isDeleting=!1}},gameOver:function(){this.status&&(console.log("\u8f93\u4e86"),this.FailedModal.active=!0,this.FailedModal.runAction(cc.fadeIn(.3)),this.status=0)},init:function(){var e=this;this.node.removeAllChildren(),this.status=1,this.curScore=0,this.hexes=[],this._hexes=[],this.boardFrameList=[],this.hexSide--;for(var t=-this.hexSide;t<=this.hexSide;t++)for(var o=Math.max(-this.hexSide,-t-this.hexSide),r=Math.min(this.hexSide,-t+this.hexSide),i=o;i<=r;i++){var n=t+this.hexSide,s=i-o;this.hexes[n]||(this.hexes[n]=[]),this._hexes[n]||(this._hexes[n]=[]),this.hexes[n][s]=this.hex2pixel({q:t,r:i},this.tileH),this._hexes[n][s]={q:t,r:i}}this.hexes.forEach(function(t,o){e.setSpriteFrame(t,o)}),this.getOldScore()},hex2pixel:function(e,t){var o=t/2,r=o*Math.sqrt(3)*(e.q+e.r/2),i=3*o/2*e.r;return cc.v2(r,i)},setSpriteFrame:function(e,t){for(var o=0;o<e.length;o++){var r=new cc.Node("frame");r.addComponent(cc.Sprite).spriteFrame=this.tilePic,r.x=e[o].x,r.y=e[o].y,r.scale=.7,r.parent=this.node,e[o].spriteFrame=r,this.setShadowNode(r),this.setFillNode(r),this.setWpos(r,this._hexes[t][o]),this.boardFrameList.push(r)}},setShadowNode:function(e){var t=new cc.Node("shadowNode");t.addComponent(cc.Sprite),t.opacity=150,t.parent=e},setFillNode:function(e){var t=new cc.Node("fillNode");t.addComponent(cc.Sprite),t.parent=e},setWpos:function(e,t){var o=e.convertToWorldSpaceAR(cc.v2(0,0));e.w_pos=o},update:function(e){if(!(e>.5)&&this.status&&this.score_fired)if(this.scoreAnimDt<.5){this.scoreAnimDt+=e;var t=Math.floor(this.shouldAddScore*this.scoreAnimDt*2);this.scoreLabel.string=this.curScore+t}else this.score_fired=!1,this.curScore+=this.shouldAddScore}}),cc._RF.pop()},{"./Util":"Util",Config:"Config"}],Config:[function(e,t,o){"use strict";cc._RF.push(t,"6c90aUK/DBJtZGoJqW6BWXM","Config"),Object.defineProperty(o,"__esModule",{value:!0});o.default={DelRules:[[0,1,2,3,4],[5,6,7,8,9,10],[11,12,13,14,15,16,17],[18,19,20,21,22,23,24,25],[26,27,28,29,30,31,32,33,34],[35,36,37,38,39,40,41,42],[43,44,45,46,47,48,49],[50,51,52,53,54,55],[56,57,58,59,60],[26,35,43,50,56],[18,27,36,44,51,57],[11,19,28,37,45,52,58],[5,12,20,29,38,46,53,59],[0,6,13,21,30,39,47,54,60],[1,7,14,22,31,40,48,55],[2,8,15,23,32,41,49],[3,9,16,24,33,42],[4,10,17,25,34],[0,5,11,18,26],[1,6,12,19,27,35],[2,7,13,20,28,36,43],[3,8,14,21,29,37,44,50],[4,9,15,22,30,38,45,51,56],[10,16,23,31,39,46,52,57],[17,24,32,40,47,53,58],[25,33,41,48,54,59],[34,42,49,55,60]],Tiles:[{type:1,list:[[[0,0]]]},{type:2,list:[[[1,-1],[0,0],[1,0],[0,1]],[[0,0],[1,0],[-1,1],[0,1]],[[0,0],[1,0],[0,1],[1,1]]]},{type:3,list:[[[0,-1],[0,0],[0,1],[0,2]],[[0,0],[1,-1],[-1,1],[-2,2]],[[-1,0],[0,0],[1,0],[2,0]]]},{type:4,list:[[[0,0],[0,1],[0,-1],[-1,0]],[[0,0],[0,-1],[1,-1],[-1,1]],[[0,0],[0,1],[0,-1],[1,0]],[[0,0],[1,0],[-1,0],[1,-1]],[[0,0],[1,0],[-1,0],[-1,1]]]},{type:5,list:[[[0,0],[0,1],[0,-1],[1,-1]],[[0,0],[1,-1],[-1,1],[-1,0]],[[0,0],[1,-1],[-1,1],[1,0]],[[0,0],[1,0],[-1,0],[0,-1]],[[0,0],[1,0],[-1,0],[0,1]]]},{type:6,list:[[[0,-1],[-1,0],[-1,1],[0,1]],[[-1,0],[0,-1],[1,-1],[1,0]],[[0,-1],[1,-1],[1,0],[0,1]],[[-1,1],[0,1],[1,0],[1,-1]],[[-1,0],[-1,1],[0,-1],[1,-1]],[[-1,0],[-1,1],[0,1],[1,0]]]}]},t.exports=o.default,cc._RF.pop()},{}],Failed:[function(e,t,o){"use strict";cc._RF.push(t,"c6a8fRZogRMEoiezwSh20jW","Failed"),cc.Class({extends:cc.Component,properties:{game:cc.Component},start:function(){},enterCB:function(){this.game.Again()}}),cc._RF.pop()},{}],Util:[function(e,t,o){"use strict";cc._RF.push(t,"c0a73l5+3VFuq+cfo39xYt9","Util"),Object.defineProperty(o,"__esModule",{value:!0});o.default={arrIntersect:function(e,t){for(var o=[],r=0;r<e.length;r++)for(var i=0;i<t.length;i++)t[i]==e[r]&&o.push(t[i]);return o},checkArrIsEqual:function(e,t){for(var o=0;o<e.length;o++)if(t[o]!=e[o])return!1;return!0}},t.exports=o.default,cc._RF.pop()},{}],hexCreator:[function(e,t,o){"use strict";cc._RF.push(t,"4063413ziFJ573EdtZfBjyf","hexCreator");(function(e){e&&e.__esModule})(e("Board"));var r=e("Config");var i=function(e,t){var o=Math.random();return e+Math.floor((t-e)*o)};cc.Class({extends:cc.Component,properties:{tileH:122,tileScale:.5,hexagons:cc.Node,type1:{default:null,type:cc.SpriteFrame},type2:{default:null,type:cc.SpriteFrame},type3:{default:null,type:cc.SpriteFrame},type4:{default:null,type:cc.SpriteFrame},type5:{default:null,type:cc.SpriteFrame},type6:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.resetPos(),this.board=this.node.parent.parent.getChildByName("Board").getComponent("Board"),this.setTile(),this.addTouchEvent()},resetPos:function(){return this._posArr=[[-240,-370],[0,-370],[240,-370]],this.node.setPosition(this._posArr[parseInt(this.node.name)-1][0],this._posArr[parseInt(this.node.name)-1][1]),this.node.ox=this.node.x,this.node.oy=this.node.y,this},reset:function(){console.log(this.node.x,this.node.y)},setTile:function(){var e=this;this.tiles=r.Tiles;var t=this.random(),o=t.list.map(function(t){return e.hex2pixel(t,e.tileH)});this.setSpriteFrame(o,this["type"+t.type]),this.node.ox=this.node.x,this.node.oy=this.node.y,this.hexagons.scale=this.tileScale},random:function(){this._shape=i(0,this.tiles.length);var e=this.tiles[this._shape];this._list=i(0,e.list.length);var t=e.list[this._list];return{type:e.type,list:t}},hex2pixel:function(e,t){var o=t/2,r=o*Math.sqrt(3)*(e[0]+e[1]/2),i=3*o/2*e[1];return cc.v2(r,i)},setSpriteFrame:function(e,t){for(var o=0;o<e.length;o++){var r=new cc.Node("frame");r.x=e[o].x,r.y=e[o].y,r.addComponent(cc.Sprite).spriteFrame=t,r.parent=this.hexagons;var i=r.convertToWorldSpaceAR(cc.v2(0,0));r.w_pos=i,r.scale=.7}},addTouchEvent:function(){var e=this;this.node.on("touchstart",function(t){if(!e.board.isDeleting){e.touch_started=!0;var o=t.getLocation();e.hexagons.setPosition(e.node.convertToNodeSpaceAR(o)),e.hexagons.y+=70,e.hexagons.scale=.8,e.hexagons.children.forEach(function(e){e.scale=.6}),e.boardTiles=[],e.fillTiles=[]}}),this.node.on("touchmove",function(t){if(!e.board.isDeleting&&e.touch_started){var o=t.touch.getDelta(),r=o.x,i=o.y;e.node.x+=r,e.node.y+=i,Math.abs(r)>=50||Math.abs(i)>=50||(e.checkCollision(),e.checkCanDrop()?e.dropPrompt(!0):e.dropPrompt(!1))}}),this.node.on("touchend",function(){!e.board.isDeleting&&e.touch_started&&e.tileDrop()}),this.node.on("touchcancel",function(){!e.board.isDeleting&&e.touch_started&&e.tileDrop()})},tileDrop:function(){if(this.touch_started=!1,this.resetBoardFrames(),this.checkCanDrop()){for(var e=this.boardTiles,t=this.fillTiles,o=t.length,r=0;r<o;r++){var i=e[r],n=t[r],s=i.getChildByName("fillNode"),c=n.getComponent(cc.Sprite).spriteFrame;i.isFulled=!0,s.getComponent(cc.Sprite).spriteFrame=c,s.scale=.8,s.runAction(cc.scaleTo(.2,1))}this.resetTile(),this.board.dropSuccess(e[e.length-1])}else this.backSourcePos();this.board.checkLose(!0)},wposGetNode:function(e){var t=e.x,o=e.y;return this.board.boardFrameList.filter(function(e){return!e.isFulled&&Math.abs(e.w_pos.x-t)<=3&&Math.abs(e.w_pos.y-o)<=3})[0]},checkLose:function(){var e=this.hexagons.children,t=this.board.boardFrameList,o=t.length,r=[];e.forEach(function(e){return r.push(e.w_pos)});var i=[];r.forEach(function(e,t){r[t+1]&&i.push(r[t+1].sub(r[0]))});for(var n=!0,s=0;s<o;s++){var c=t[s];if(!c.isFulled){for(var a=[],h=0,l=i.length;h<l;h++){var d=c.w_pos.add(i[h]);a.push(this.wposGetNode(d))}if(0===a.length||a.every(function(e){return!!e})){console.log(this.node.name,"\u8fd8\u80fd\u73a9"),n=!1;break}}}return n},resetTile:function(e){var t=this.node.oy;this.hexagons.removeAllChildren();var o=cc.v2(cc.winSize.width+this.node.width,-this.node.height);if(this.node.setPosition(this.node.parent.convertToNodeSpaceAR(o)),this.hexagons.setPosition(0,0),this.hexagons.scale=1,this.setTile(),e)return this.node.x=this.node.ox,void(this.node.y=this.node.oy);this.scrollView(t)},scrollView:function(e){var t=this;if("1"==this.node.name){var o=this.node.parent.getChildByName("2");o.name="1",o.runAction(cc.moveBy(.2,-240,0));var r=this.node.parent.getChildByName("3");r.name="2",r.runAction(cc.moveBy(.2,-240,0)),this.node.name="3",this.node.runAction(cc.sequence(cc.moveTo(.2,240,e),cc.callFunc(function(e){t.node.ox=t.node.x,t.node.oy=t.node.y})))}else if("2"===this.node.name){var i=this.node.parent.getChildByName("3");i.name="2",i.runAction(cc.moveBy(.2,-240,0)),this.node.name="3",this.node.runAction(cc.sequence(cc.moveTo(.2,240,e),cc.callFunc(function(e){t.node.ox=t.node.x,t.node.oy=t.node.y})))}else this.node.runAction(cc.sequence(cc.moveTo(.2,240,e),cc.callFunc(function(e){t.node.ox=t.node.x,t.node.oy=t.node.y})))},backSourcePos:function(){this.hexagons.children.forEach(function(e){e.runAction(cc.scaleTo(.2,.7))}),this.hexagons.runAction(cc.sequence(cc.scaleTo(.2,this.tileScale),cc.moveTo(.1,0,0))),this.node.runAction(cc.moveTo(.2,this._posArr[parseInt(this.node.name)-1][0],this._posArr[parseInt(this.node.name)-1][1]))},checkCollision:function(){var e=this.hexagons.children;this.boardTiles=[],this.fillTiles=[];for(var t=0;t<e.length;t++){var o=e[t],r=this.hexagons.position.sub(cc.v2(0,0)),i=this.node.position.add(r).add(o.position),n=this.checkDistance(i);n&&(this.fillTiles.push(o),this.boardTiles.push(n))}},checkDistance:function(e){for(var t=this.board.boardFrameList,o=0;o<t.length;o++){var r=t[o];if(r.position.sub(e).mag()<=35)return r}},checkCanDrop:function(){var e=this.boardTiles,t=this.hexagons.children,o=e.length,r=t.length;if(0===o||o!=r)return!1;for(var i=0;i<o;i++)if(e[i].isFulled)return!1;return!0},resetBoardFrames:function(){for(var e=this.board.boardFrameList,t=0;t<e.length;t++){e[t].getChildByName("shadowNode").opacity=0}},dropPrompt:function(e){var t=this.boardTiles,o=t.length,r=this.fillTiles;if(this.resetBoardFrames(),e)for(var i=0;i<o;i++){var n=t[i].getChildByName("shadowNode");n.opacity=100;var s=r[i].getComponent(cc.Sprite).spriteFrame;n.getComponent(cc.Sprite).spriteFrame=s}},start:function(){}}),cc._RF.pop()},{Board:"Board",Config:"Config"}],main:[function(e,t,o){"use strict";cc._RF.push(t,"c7378R3ZJ9DGavx1Uiv1TSQ","main"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,n=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hexCreatorPrefab=null,t.TileContainer=null,t.board=null,t}return __extends(t,e),t.prototype.start=function(){this.createHexCreator()},t.prototype.createHexCreator=function(){for(var e=0;e<3;e++){var t=cc.instantiate(this.hexCreatorPrefab);t.name=(e+1).toString(),t.parent=this.TileContainer}},t.prototype.Again=function(){this.board.reset(),this.board.checkLose(),this.board.FailedModal.active=!1},t.prototype.onClose=function(){this.node.destroy()},__decorate([n(cc.Prefab)],t.prototype,"hexCreatorPrefab",void 0),__decorate([n({type:cc.Node,displayName:"\u79ef\u5757\u751f\u6210\u533a\u7236\u8282\u70b9"})],t.prototype,"TileContainer",void 0),__decorate([n({type:cc.Component,displayName:"\u68cb\u76d8\u7ec4\u4ef6"})],t.prototype,"board",void 0),t=__decorate([i],t)}(cc.Component);o.default=s,cc._RF.pop()},{}],root:[function(e,t,o){"use strict";cc._RF.push(t,"95ff4wm9XVN17Ypp6o5NWil","root"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,n=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GameModule=null,t.HexagonEliminatePrefab=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.onOpenHexagonEliminate=function(){cc.instantiate(this.HexagonEliminatePrefab).parent=this.GameModule},__decorate([n({type:cc.Node,displayName:"\u6e38\u620f\u6a21\u5757\u8282\u70b9"})],t.prototype,"GameModule",void 0),__decorate([n({type:cc.Prefab,displayName:"\u516d\u89d2\u6d88\u9664\u6a21\u5757\u9884\u5236\u4ef6"})],t.prototype,"HexagonEliminatePrefab",void 0),t=__decorate([i],t)}(cc.Component);o.default=s,cc._RF.pop()},{}]},{},["Board","Config","Failed","Util","hexCreator","main","root"]);